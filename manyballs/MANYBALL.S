; Got to supervisor mode, ignoring current stack
		CLR.W	-(SP)
		MOVE.W	#$20,-(SP)
		TRAP	#1
		ADDQ.W	#4,SP

; Save current set color palette from register 0 at $FF8240 16-bit
; This ensures that we can restore the previous colors when the program ends
		MOVE.L	#$FF8240,A0
		MOVEQ.L	#15,D0
		MOVE.L	#OLDPAL,A1
CSAVE:	MOVE.W	(A0)+,(A1)+
		DBF		D0,CSAVE


		MOVE.L	$44E,A1
		MOVE.L	#7999,D0
CL:		CLR.L	(A1)+
		DBF		D0,CL

; Set the color palette from our loaded graphics using XBIOS (trap #14)
; Colors are stored in PI1 files, as a 32-byte array starting at a 2-byte offset
		MOVE.L	#GRAPICS+2,-(SP)
		MOVE.W	#6,-(SP)
		TRAP	#14
		ADDQ.W	#6,SP

		MOVEM.L	GRAPICS+2,D0-D7
		MOVEM.L	D0-D7,$FF8240

; Wait for video (vsync) and then branch to the routine for drawing the balls
SYNC:	MOVE.W	#37,-(SP)
		TRAP	#14
		ADDQ	#2,SP
		BSR		ROUT

; Check that key has not been pressed
		MOVE.W	#$0B,-(SP)
		TRAP	#1
		ADDQ	#2,SP
		CMP		#0,D0
		BEQ		SYNC

; Restore previously stored color palette before terminating
		MOVE.L	#$FF8240,A0
		MOVEQ.L	#15,D0
		MOVE.L	#OLDPAL,A1
CLOAD:	MOVE.W	(A1)+,(A0)+
		DBF		D0,CLOAD

; Clear stack and call GEMDOS, which implies TERM and terminates the program
		CLR.W	-(SP)
		TRAP	#1

ROUT:	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
	ADD.L	CNT1,A2
	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	MOVE.L	#16,D0

LEOP:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LEOP

	ADD.L	#1,CNT1

	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
	ADD.L	CNT2,A2
	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	ADD.L	#8,A1
	MOVE.L	#16,D0

LOOP1:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LOOP1

	ADD.L	#1,CNT2

	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
	ADD.L	CNT3,A2
	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	ADD.L	#16,A1
	MOVE.L	#16,D0

LOOP2:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LOOP2

	ADD.L	#1,CNT3

	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
	ADD.L	CNT4,A2
	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	ADD.L	#24,A1
	MOVE.L	#16,D0

LOOP3:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LOOP3

	ADD.L	#1,CNT4

	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
	ADD.L	CNT5,A2
	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	ADD.L	#32,A1
	MOVE.L	#16,D0

LOOP4:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LOOP4

	ADD.L	#1,CNT5

	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
	ADD.L	CNT6,A2
	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	ADD.L	#40,A1
	MOVE.L	#16,D0

LOOP5:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LOOP5

	ADD.L	#1,CNT6 

	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
	ADD.L	CNT7,A2
	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	ADD.L	#48,A1
	MOVE.L	#16,D0

LOOP6:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LOOP6

	ADD.L	#1,CNT7

	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
	ADD.L	CNT8,A2
	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	ADD.L	#56,A1
	MOVE.L	#16,D0

LOOP7:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LOOP7

	ADD.L	#1,CNT8 

	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
	ADD.L	CNT9,A2
	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	ADD.L	#64,A1
	MOVE.L	#16,D0

LOOP8:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LOOP8

	ADD.L	#1,CNT9

	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
	ADD.L	CNT10,A2
	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	ADD.L	#72,A1
	MOVE.L	#16,D0

LOOP9:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LOOP9

	ADD.L	#1,CNT10

	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
	ADD.L	CNT11,A2
	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	ADD.L	#80,A1
	MOVE.L	#16,D0

LOOP10:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LOOP10

	ADD.L	#1,CNT11

	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
	ADD.L	CNT12,A2
	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	ADD.L	#88,A1
	MOVE.L	#16,D0

LOOP11:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LOOP11

	ADD.L	#1,CNT12

	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
	ADD.L	CNT13,A2
	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	ADD.L	#96,A1
	MOVE.L	#16,D0

LOOP12:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LOOP12

	ADD.L	#1,CNT13

	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
	ADD.L	CNT14,A2
	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	ADD.L	#104,A1
	MOVE.L	#16,D0

LOOP13:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LOOP13

	ADD.L	#1,CNT14

	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
 	ADD.L	CNT15,A2
 	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	ADD.L	#112,A1
	MOVE.L	#16,D0

LOOP14:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LOOP14

	ADD.L	#1,CNT15

	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
	ADD.L	CNT16,A2
	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	ADD.L	#120,A1
	MOVE.L	#16,D0

LOOP15:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LOOP15

	ADD.L	#1,CNT16 

	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
	ADD.L	CNT17,A2
	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	ADD.L	#128,A1
	MOVE.L	#16,D0

LOOP16:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LOOP16

	ADD.L	#1,CNT17

	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
	ADD.L	CNT18,A2
	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	ADD.L	#136,A1
	MOVE.L	#16,D0

LOOP17:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LOOP17

	ADD.L	#1,CNT18 

	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
	ADD.L	CNT19,A2
	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	ADD.L	#144,A1
	MOVE.L	#16,D0

LOOP18:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LOOP18

	ADD.L	#1,CNT19 

	MOVE.L	#GRAPICS+34,A0
	MOVE.L	$44E.W,A1
	MOVEQ.L	#0,D0
	MOVE.L	#SINE,A2
	ADD.L	CNT20,A2
	MOVE.B	(A2),D0
	MULU	#160,D0
	ADD.L	D0,A1
	ADD.L	#152,A1
	MOVE.L	#16,D0

LOOP19:	MOVE.L	(A0),(A1)
	MOVE.L	4(A0),4(A1)
	ADD.L	#160,A0
	ADD.L	#160,A1
	DBF	D0,LOOP19

	ADD.L	#1,CNT20 
NE1
	CMP.L	#1000,CNT1
	BEQ	ZERO1
NE2	
	CMP.L	#1000,CNT2
	BEQ	ZERO2
NE3
	CMP.L	#1000,CNT3
	BEQ	ZERO3
NE4
	CMP.L	#1000,CNT4
	BEQ	ZERO4
NE5
	CMP.L	#1000,CNT5
	BEQ	ZERO5
NE6
	CMP.L	#1000,CNT6
	BEQ	ZERO6
NE7
	CMP.L	#1000,CNT7
	BEQ	ZERO7
NE8
	CMP.L	#1000,CNT8
	BEQ	ZERO8
NE9	
	CMP.L	#1000,CNT9
	BEQ	ZERO9
NE10
	CMP.L	#1000,CNT10
	BEQ	ZERO10
NE11
	CMP.L	#1000,CNT11
	BEQ	ZERO11
NE12
	CMP.L	#1000,CNT12
	BEQ	ZERO12
NE13
	CMP.L	#1000,CNT13
	BEQ	ZERO13
NE14
	CMP.L	#1000,CNT14
	BEQ	ZERO14
NE15
	CMP.L	#1000,CNT15
	BEQ	ZERO15
NE16
	CMP.L	#1000,CNT16
	BEQ	ZERO16
NE17	
	CMP.L	#1000,CNT17
	BEQ	ZERO17
NE18
	CMP.L	#1000,CNT18 
	BEQ	ZERO18
NE19	
	CMP.L	#1000,CNT19
	BEQ	ZERO19
NE20	
	CMP.L	#1000,CNT20
	BEQ	ZERO20
	
	RTS

ZERO1:	MOVE.L	#0,CNT1
	BRA	NE2

ZERO2:	MOVE.L	#0,CNT2
	BRA	NE3

ZERO3:	MOVE.L	#0,CNT3
	BRA	NE4

ZERO4:	MOVE.L	#0,CNT4
	BRA	NE5

ZERO5:	MOVE.L	#0,CNT5
	BRA	NE6

ZERO6:	MOVE.L	#0,CNT6
	BRA	NE7

ZERO7:	MOVE.L	#0,CNT7
	BRA	NE8

ZERO8:	MOVE.L	#0,CNT8
	BRA	NE9

ZERO9:	MOVE.L	#0,CNT9
	BRA	NE10

ZERO10:	MOVE.L	#0,CNT10
	BRA	NE11

ZERO11:	MOVE.L	#0,CNT11
	BRA	NE12

ZERO12:	MOVE.L	#0,CNT12
	BRA	NE13

ZERO13:	MOVE.L	#0,CNT13
	BRA	NE14

ZERO14:	MOVE.L	#0,CNT14
	BRA	NE15

ZERO15:	MOVE.L	#0,CNT15
	BRA	NE16

ZERO16:	MOVE.L	#0,CNT16
	BRA	NE17

ZERO17:	MOVE.L	#0,CNT17
	BRA	NE18

ZERO18:	MOVE.L	#0,CNT18
	BRA	NE19

ZERO19:	MOVE.L	#0,CNT19
	BRA	NE20

ZERO20:	MOVE.L	#0,CNT20
	RTS

CNT1:	DC.L	0
CNT2:	DC.L	4
CNT3:	DC.L	8
CNT4:	DC.L	12
CNT5:	DC.L	16
CNT6:	DC.L	20
CNT7:	DC.L	24
CNT8:	DC.L	28
CNT9:	DC.L	32
CNT10:	DC.L	36
CNT11:	DC.L	40
CNT12:	DC.L	44
CNT13:	DC.L	48
CNT14:	DC.L	52
CNT15:	DC.L	56
CNT16:	DC.L	60
CNT17:	DC.L	64
CNT18:	DC.L	68
CNT19:	DC.L	72
CNT20:	DC.L	76

OLDPAL:	DS.W	16

GRAPICS:	INCBIN	C:\ASM68K\MANYBALL\SINEBALL.PI1
SINE:		INCBIN	C:\ASM68K\MANYBALL\CSINE.SIN
		EVEN
